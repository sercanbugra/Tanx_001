#define BLYNK_PRINT Serial
#include <ESP8266WiFi.h>
#include <Blynk.h>
#include <BlynkSimpleEsp8266.h>
#include <SPI.h>
#include <RF24.h>
#include <Servo.h>

Servo servo;

#define tank_namlusu 14   // (D5) 

#define atesleme  4      // (D2) 

#define Sag_Hiz  12        // EnA D6
#define Sol_Hiz  5        // EnB D1

#define Sag_Ileri   15     // (D8)
#define Sag_Geri   13     //  (D7)

#define Sol_Ileri    2     // (D4)
#define Sol_Geri    0     // (D3)


char auth[] = "xVGQy0ru1MdAjFf1I0dRaVTyG8yWimGh";
char ssid[] = "FiberHGW_TP6392_2.4GHz";
char pass[] = "UHwPufPX";

int minRange = 312;
int maxRange = 712;

int minSpeed = 511;
int maxSpeed = 1023;
int noSpeed = 0;

void moveControl2(int a){

servo.write(a);
}

void ates(int q)
{

if(q==1){
  
digitalWrite(atesleme,HIGH);
delay(1000);
Serial.print("atesleme durumu =");
Serial.println(q);
}

else
{ 
 digitalWrite(atesleme,LOW);   
}}

void moveControl(int x, int y)

{

//ileri

  if(y >= maxRange && x >= minRange && x <= maxRange) //zataci R
  {
    
    digitalWrite(Sag_Ileri,HIGH); 
    digitalWrite(Sag_Geri,LOW);
    digitalWrite(Sol_Ileri,HIGH);
    digitalWrite(Sol_Geri,LOW);
    analogWrite(Sag_Hiz,y);
    analogWrite(Sol_Hiz,y);
    
  }
 
  // sag_ileri
  
  else if(x >= maxRange && y >= maxRange)   //zataci R
  {
    
    digitalWrite(Sag_Ileri,HIGH); 
    digitalWrite(Sag_Geri,LOW);
    digitalWrite(Sol_Ileri,HIGH);
    digitalWrite(Sol_Geri,LOW);
    analogWrite(Sag_Hiz,noSpeed);
    analogWrite(Sol_Hiz,y);
    
  }

  // sol_ileri
  
  else if(x <= minRange && y >= maxRange)
  {
    digitalWrite(Sag_Ileri,HIGH); 
    digitalWrite(Sag_Geri,LOW);
    digitalWrite(Sol_Ileri,HIGH);
    digitalWrite(Sol_Geri,LOW);
    analogWrite(Sag_Hiz,y);
    analogWrite(Sol_Hiz,noSpeed);
   
  }

  // neutral zone
  else if(y < maxRange && y > minRange && x < maxRange && x > minRange)
  {
    analogWrite(Sag_Hiz,noSpeed);
    analogWrite(Sol_Hiz,noSpeed);
  
  }

 // Geri
 
  else if(y <= minRange && x >= minRange && x <= maxRange)
  {
    digitalWrite(Sag_Ileri,LOW); 
    digitalWrite(Sag_Geri,HIGH);
    digitalWrite(Sol_Ileri,LOW);
    digitalWrite(Sol_Geri,HIGH);
    analogWrite(Sag_Hiz,1000-y);
    analogWrite(Sol_Hiz,1000-y);
    
  }

  // Sag_geri
  
 else if(y <= minRange && x <= minRange)
  {
    digitalWrite(Sag_Ileri,LOW); 
    digitalWrite(Sag_Geri,HIGH);
    digitalWrite(Sol_Ileri,LOW);
    digitalWrite(Sol_Geri,HIGH);
    analogWrite(Sag_Hiz,noSpeed);
    analogWrite(Sol_Hiz,1000-y); 
    
  }

  // sol_geri
  
  else if(y <= minRange && x >= maxRange)
  {
    digitalWrite(Sag_Ileri,LOW); 
    digitalWrite(Sag_Geri,HIGH);
    digitalWrite(Sol_Ileri,LOW);
    digitalWrite(Sol_Geri,HIGH);
    analogWrite(Sag_Hiz,1000-y);
    analogWrite(Sol_Hiz,noSpeed);
    
  }
}

void setup()
{
  Serial.begin(9600);
  
  servo.attach(tank_namlusu);
  
  Blynk.begin(auth, ssid, pass);



 
  // initial settings for motors off and direction forward
  pinMode(Sag_Hiz, OUTPUT);
  pinMode(Sol_Hiz, OUTPUT);
  pinMode(Sag_Ileri, OUTPUT);
  pinMode(Sol_Ileri, OUTPUT);
  pinMode(Sag_Geri, OUTPUT);
  pinMode(Sol_Geri, OUTPUT);
  pinMode(atesleme,OUTPUT);

 
  digitalWrite(Sag_Ileri,LOW); 
  digitalWrite(Sag_Geri,LOW);
  digitalWrite(Sol_Ileri,LOW);
  digitalWrite(Sol_Geri,LOW);
  digitalWrite(atesleme,LOW);
 
 }


void loop()
{
  
  Blynk.run();

}



BLYNK_WRITE(V3)
{
 int q = param.asInt();
  ates(q);
}


BLYNK_WRITE(V2)
{
  int a = 180- param[0].asInt();

  
  Serial.print("a value is: ");
  Serial.println(a);

  moveControl2(a);
}

BLYNK_WRITE(V1)
{
  int x = param[0].asInt();
  int y = param[1].asInt();
 
  Serial.print("x value is: ");
  Serial.println(x);
  Serial.print("y value is: ");
  Serial.println(y);


  moveControl(x,y);
}
